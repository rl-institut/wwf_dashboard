<!DOCTYPE html>
<html>
  <head>
    {% if not debug %}
      <script type="text/javascript">
        var s = "";
        const pw = "panda";
        while (s != pw) {
          s = prompt("Bitte Passwort eingeben");
          if (s != pw) {
            alert("Falsches Passwort - bitte versuch es erneut!");
          }
        }
       </script>
    {% endif %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/styling.min.css">
    <style>

    #chart div {
      font: 10px sans-serif;
      text-align: right;
      padding: 3px;
      margin: 1px;
      color: white;
    }

    </style>
    <title>D3 Chart </title>
  </head>

  <body>
    <div class="frame">
      <div class="frame__maxwidth">
        <div class="tile">
          <div class="tile__header">
            <h3 class="title">Immer mehr CO2 verschärft Klimakrise</h3>
            <p class="text">Mit den weltweit steigenden Emissionen steigen Jahr für Jahr auch die CO2-Konzentration in der Atmosphäre und die Temperatur auf der Erde.</p>
          </div>
          <div class="tile__slider">
            <div class="range-wrap">
              <div class="range-value" id="rangeV"></div>
              <input id="range" type="range" min="1900" max="2020" value="200" step="1" id="yearRange" onchange="changeYear(this.value);">
            </div>
            <div class="range-values">
              <span>1900</span>
              <span>1920</span>
              <span>1940</span>
              <span>1960</span>
              <span>1980</span>
              <span>2000</span>
              <span>2020</span>
            </div>
          </div>
          <div class="tile__chart">
            <div id="chart"></div>
          </div>
        </div>
    
        <div class="tile">
          <div class="tile__header">
            <h3 class="title">Erneuerbare setzen sich durch</h3>
            <p class="text">Unser Energieverbrauch basiert immer noch weitgehend auf Öl, Gas und Kohle. Vor allem im Wärme- und Verkehrssektor ist der Anteil der Erneuerbaren Energien gering. </p>
          </div>
          <div class="tile__slider">
            <div class="range-wrap" style="width: 75%;">
              <input type="range" class="range" min="1990" max="2020">
              <output class="bubble"></output>
            </div>
          </div>
          <div class="tile__chart">
            Chart hier
          </div>
        </div>
      </div>
    </div>

    <script src = "static/libs/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
      const margin = {top: 30, right: 30, bottom: 70, left: 60};
      const width = 460 - margin.left - margin.right;
      const height = 500 - margin.top - margin.bottom;

      var data = {{data|tojson}};

      // Slider
      // from https://codepen.io/onyx1812/pen/GRJxmva
      const
        range = document.getElementById('range'),
        rangeV = document.getElementById('rangeV'),
        setValue = ()=>{
          const
            newValue = Number( (range.value - range.min) * 100 / (range.max - range.min) ),
            newPosition = 10 - (newValue * 0.2);
          rangeV.innerHTML = `<span>${range.value}</span>`;
          rangeV.style.left = `calc(${newValue}% + (${newPosition}px))`;
        };
      document.addEventListener("DOMContentLoaded", setValue);
      range.addEventListener('input', setValue);
    </script>
    <script src="static/js/chart.js"></script>
  </body>
</html>