<!DOCTYPE html>
<html>
  <head>
    {% if not debug %}
      <script type="text/javascript">
        var s = "";
        const pw = "panda";
        while (s != pw) {
          s = prompt("Bitte Passwort eingeben");
          if (s != pw) {
            alert("Falsches Passwort - bitte versuch es erneut!");
          }
        }
       </script>
    {% endif %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/styling.min.css">
    <style>

    #chart div {
      font: 10px sans-serif;
      text-align: right;
      padding: 3px;
      margin: 1px;
      color: white;
    }

    </style>
    <title>D3 Chart </title>
  </head>

  <body>
    <div class="frame">
      <div class="frame__maxwidth">
        <div class="tile">
          <div class="tile__header">
            <h3 class="title">Immer mehr CO2 verschärft Klimakrise</h3>
            <p class="text">Mit den weltweit steigenden Emissionen steigen Jahr für Jahr auch die CO2-Konzentration in der Atmosphäre und die Temperatur auf der Erde.</p>
          </div>
          <div class="tile__slider">
            <div class="range-wrap">
              <input type="range" class="range" min="1900" max="2020" id="yearRange" onchange="changeYear(this.value);">
              <output class="bubble"></output>
            </div>
            <label for="yearRange" class="form-label">Select year</label>
            
          </div>
          <div class="tile__chart">
            <div id="chart"></div>
          </div>
        </div>
    
        <div class="tile">
          <div class="tile__header">
            <h3 class="title">Erneuerbare setzen sich durch</h3>
            <p class="text">Unser Energieverbrauch basiert immer noch weitgehend auf Öl, Gas und Kohle. Vor allem im Wärme- und Verkehrssektor ist der Anteil der Erneuerbaren Energien gering. </p>
          </div>
          <div class="tile__slider">
            <div class="range-wrap" style="width: 75%;">
              <input type="range" class="range" min="1990" max="2020">
              <output class="bubble"></output>
            </div>
          </div>
          <div class="tile__chart">
            Chart hier
          </div>
        </div>
      </div>
    </div>

    <script src = "static/libs/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
      const margin = {top: 30, right: 30, bottom: 70, left: 60};
      const width = 460 - margin.left - margin.right;
      const height = 500 - margin.top - margin.bottom;

      var data = {{data|tojson}};

      // Slider
      // from https://codepen.io/chriscoyier/pen/eYNQyPe
      const allRanges = document.querySelectorAll(".range-wrap");
      allRanges.forEach(wrap => {
        const range = wrap.querySelector(".range");
        const bubble = wrap.querySelector(".bubble");

        range.addEventListener("input", () => {
          setBubble(range, bubble);
        });
        setBubble(range, bubble);
      });

      function setBubble(range, bubble) {
        const val = range.value;
        const min = range.min ? range.min : 0;
        const max = range.max ? range.max : 100;
        const newVal = Number(((val - min) * 100) / (max - min));
        bubble.innerHTML = val;
        bubble.style.left = `calc(${newVal}% + (${8 - newVal * 0.15}px))`;
      }
    </script>
    <script src="static/js/chart.js"></script>
  </body>
</html>